(function(n,u,v,w){n.fn.image8bit=function(b){b=n.extend({blocksize:5,granularity:16},b);n(this).each(function(){var o=n(this),x=o[0],p=o.width(),q=o.height(),j=u.createElement(v),g=u.createElement(v),s,k,l,d,e,a,m,h,f,i,c,t,r;if(j.getContext&&x.tagName==="IMG"){j.width=p;j.height=q;s=j.getContext(w);g.width=g.height=1;g=g.getContext(w);for(d=0;d<q;d+=b.blocksize)for(e=0;e<p;e+=b.blocksize){k=l=b.blocksize;if(k+e>p)k=p-e;if(l+d>q)l=q-d;g.drawImage(x,e,d,k,l,0,0,1,1);try{a=g.getImageData(0,0,1,1).data}catch(y){window.console&&
window.console.log&&console.log(y.message);return}h=a[0]/255;f=a[1]/255;i=a[2]/255;a=Math.max(h,f,i);m=Math.min(h,f,i);c=t=0;r=(a+m)/2;if(a!==m){c=a-m;t=r>0.5?c/(2-a-m):c/r*2;switch(a){case h:c=(f-i)/c+(f<i?6:0);break;case f:c=(i-h)/c+2;break;default:c=(h-f)/c+4}}a=[Math.round(c/6/b.granularity*100)*b.granularity*3.6,Math.round(t/b.granularity*100)*b.granularity+"%",Math.round(r/b.granularity*100)*b.granularity];s.fillStyle="hsl("+a.join(",")+"%)";s.fillRect(e,d,k,l)}o.replaceWith(j)}})}})(jQuery,
document,"canvas","2d");
