(function(i,n,o,s){i.fn.image8bit=function(b){if(n.createElement(o).getContext){b=i.extend({blocksize:5,granularity:16},b);i(this).each(function(){var j=i(this),t=j[0],k=j.width(),l=j.height(),m=n.createElement(o),h=n.createElement(o),p,d,e,f,g,a,c,q,r;m.width=k;m.height=l;p=m.getContext(s);h.width=h.height=1;h=h.getContext(s);for(f=0;f<l;f+=b.blocksize)for(g=0;g<k;g+=b.blocksize){d=e=b.blocksize;if(d+g>k)d=k-g;if(e+f>l)e=l-f;h.drawImage(t,g,f,d,e,0,0,1,1);try{a=h.getImageData(0,0,1,1).data}catch(u){window.console&&
window.console.log&&console.log(u.message);return}a=[a[0]/255,a[1]/255,a[2]/255];d=Math.max(a[0],a[1],a[2]);e=Math.min(a[0],a[1],a[2]);c=q=0;r=(d+e)/2;if(d!==e){c=d-e;q=r>0.5?c/(2-d-e):c/(d+e);switch(d){case a[0]:c=(a[1]-a[2])/c+(a[1]<a[2]?6:0);break;case a[1]:c=(a[2]-a[0])/c+2;break;default:c=(a[0]-a[1])/c+4;break}c/=6}a=[c,q,r];a[0]=Math.round(a[0]/b.granularity*100)*b.granularity*3.6;a[1]=Math.round(a[1]/b.granularity*100)*b.granularity+"%";a[2]=Math.round(a[2]/b.granularity*100)*b.granularity;
p.fillStyle="hsl("+a.join(",")+"%)";p.fillRect(g,f,b.blocksize,b.blocksize)}j.replaceWith(m)})}}})(jQuery,document,"canvas","2d");
