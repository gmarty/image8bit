(function(l,q,r,t){l.fn.image8bit=function(b){if(q.createElement(r).getContext){b=l.extend({blocksize:5,granularity:16},b);l(this).each(function(){var m=l(this),w=m[0],n=m.width(),o=m.height(),p=q.createElement(r),g=q.createElement(r),s,d,c,e,f,a;p.width=n;p.height=o;s=p.getContext(t);g.width=g.height=1;g=g.getContext(t);for(e=0;e<o;e+=b.blocksize)for(f=0;f<n;f+=b.blocksize){d=c=b.blocksize;if(d+f>n)d=n-f;if(c+e>o)c=o-e;g.drawImage(w,f,e,d,c,0,0,1,1);a=g.getImageData(0,0,1,1).data;d=a[0];c=a[1];a=
a[2];d/=255;c/=255;a/=255;var h=Math.max(d,c,a),j=Math.min(d,c,a),k=0,u=0,v=(h+j)/2,i=void 0;if(h!==j){i=h-j;u=v>0.5?i/(2-h-j):i/(h+j);switch(h){case d:k=(c-a)/i+(c<a?6:0);break;case c:k=(a-d)/i+2;break;default:k=(d-c)/i+4;break}k/=6}a=[k,u,v];a[0]=Math.round(a[0]/b.granularity*100)*b.granularity*3.6;a[1]=Math.round(a[1]/b.granularity*100)*b.granularity+"%";a[2]=Math.round(a[2]/b.granularity*100)*b.granularity;s.fillStyle="hsl("+a.join(",")+"%)";s.fillRect(f,e,b.blocksize,b.blocksize)}m.replaceWith(p)})}}})(jQuery,
document,"canvas","2d");
