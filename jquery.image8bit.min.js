(function(l,s,t,u){l.fn.image8bit=function(a){a=l.extend({blocksize:5,granularity:16},a);l(this).each(function(){var m=l(this),v=m[0],n=m.width(),o=m.height(),j=s.createElement(t),h=s.createElement(t),q,e,c,f,g,b,k,i,d,r,p;if(j.getContext&&v.tagName==="IMG"){j.width=n;j.height=o;q=j.getContext(u);h.width=h.height=1;h=h.getContext(u);for(f=0;f<o;f+=a.blocksize)for(g=0;g<n;g+=a.blocksize){e=c=a.blocksize;if(e+g>n)e=n-g;if(c+f>o)c=o-f;h.drawImage(v,g,f,e,c,0,0,1,1);try{b=h.getImageData(0,0,1,1).data}catch(w){window.console&&
window.console.log&&console.log(w.message);return}e=b[0]/255;c=b[1]/255;i=b[2]/255;b=Math.max(e,c,i);k=Math.min(e,c,i);d=r=0;p=(b+k)/2;if(b!==k){d=b-k;r=p>0.5?d/(2-b-k):d/p*2;switch(b){case e:d=(c-i)/d+(c<i?6:0);break;case c:d=(i-e)/d+2;break;default:d=(e-c)/d+4}}b=[Math.round(d/6/a.granularity*100)*a.granularity*3.6,Math.round(r/a.granularity*100)*a.granularity+"%",Math.round(p/a.granularity*100)*a.granularity];q.fillStyle="hsl("+b.join(",")+"%)";q.fillRect(g,f,a.blocksize,a.blocksize)}m.replaceWith(j)}})}})(jQuery,
document,"canvas","2d");
