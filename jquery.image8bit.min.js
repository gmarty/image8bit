(function(k,q,r,u){k.fn.image8bit=function(b){if(q.createElement(r).getContext){b=k.extend({blocksize:5,granularity:16},b);k(this).each(function(){var l=k(this),v=l[0],m=l.width(),n=l.height(),o=q.createElement(r),i=q.createElement(r),s,d,c,f,g,a,j,h,e,t,p;o.width=m;o.height=n;s=o.getContext(u);i.width=i.height=1;i=i.getContext(u);for(f=0;f<n;f+=b.blocksize)for(g=0;g<m;g+=b.blocksize){d=c=b.blocksize;if(d+g>m)d=m-g;if(c+f>n)c=n-f;i.drawImage(v,g,f,d,c,0,0,1,1);try{a=i.getImageData(0,0,1,1).data}catch(w){window.console&&
window.console.log&&console.log(w.message);return}d=a[0]/255;c=a[1]/255;h=a[2]/255;a=Math.max(d,c,h);j=Math.min(d,c,h);e=t=0;p=(a+j)/2;if(a!==j){e=a-j;t=p>0.5?e/(2-a-j):e/p*2;switch(a){case d:e=(c-h)/e+(c<h?6:0);break;case c:e=(h-d)/e+2;break;default:e=(d-c)/e+4}}a=[d,c,h];a[0]=Math.round(e/6/b.granularity*100)*b.granularity*3.6;a[1]=Math.round(t/b.granularity*100)*b.granularity+"%";a[2]=Math.round(p/b.granularity*100)*b.granularity;s.fillStyle="hsl("+a.join(",")+"%)";s.fillRect(g,f,b.blocksize,b.blocksize)}l.replaceWith(o)})}}})(jQuery,
document,"canvas","2d");
